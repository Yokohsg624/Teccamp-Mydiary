{% extends 'diary/base.html' %}

{% block title %}
ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§
{% endblock %}

{% block content %}
<!-- åˆå›ãƒ­ã‚°ã‚¤ãƒ³ç”¨ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
{% if not profile_image_url %}
{% if not user.personality %}
{% if not user.tone %}
<!-- ğŸ‘‡ã“ã“ã«ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãªã©å…¥ã‚Œã¦OK -->
<div id="firstLoginPopup" class="popup">
    <button id="closePopupBtn" class="popup-close-btn">Ã—</button>
    <div class="popup-content">
        <h2>MyDiaryAIã«ã‚ˆã†ã“ãï¼ğŸ‰</h2>
        <p>ã“ã“ã§ã¯æ¯æ—¥ã®æ—¥è¨˜ã«è‡ªåˆ†ã ã‘ã®ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼AIãŒè¿”ä¿¡ã‚’ãã‚Œã¾ã™ã€‚<br>
            ã¾ãšã¯<a href="{% url 'accounts:mypage'%}">ãƒã‚¤ãƒšãƒ¼ã‚¸</a>ã§ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼AIã®è¨­å®šã‚’ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼</p>
    </div>
</div>

<script>
    document.getElementById('closePopupBtn').addEventListener('click', function () {
        document.getElementById('firstLoginPopup').style.display = 'none';
    });
</script>
{% endif %}
{% endif %}
{% endif %}

<h1>ğŸ“š æ—¥è¨˜ä¸€è¦§</h1>
<form method="get" style="margin-bottom: 1.5em;">
    <label for="order"><strong>ä¸¦ã³é †ï¼š</strong></label>
    <select name="order" id="order" onchange="this.form.submit()" style="padding: 0.4em; border-radius: 5px;">
        <option value="new" {% if order == 'new' %}selected{% endif %}>æ–°ã—ã„é †</option>
        <option value="old" {% if order == 'old' %}selected{% endif %}>å¤ã„é †</option>
    </select>
</form>

{% if object_list %}
<ul style="list-style: none; padding: 0;">
    {% for diary in object_list %}
    <li class="diary-entry">
        <h2>{{ diary.title }}</h2>
        <p><strong>å†…å®¹ï¼š</strong> {{ diary.text|linebreaks }}</p>
        <p><strong>æ°—åˆ†ï¼š</strong>
            {% if diary.mood_happy %}ğŸ˜Š æ¥½ã—ã„ {% endif %}
            {% if diary.mood_sad %}ğŸ˜¢ æ‚²ã—ã„ {% endif %}
            {% if diary.mood_angry %}ğŸ˜¡ æ€’ã£ã¦ã‚‹ {% endif %}
            {% if diary.mood_anxious %}ğŸ˜Ÿ ä¸å®‰ {% endif %}
            {% if diary.mood_calm %}ğŸ˜Œ è½ã¡ç€ã„ã¦ã‚‹ {% endif %}
            {% if diary.mood_exhausted %}ğŸ˜© ç–²ã‚Œã¦ã‚‹ {% endif %}
        </p>

        {% if diary.image %}
        <p><img src="{{ diary.image.url }}" alt="ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»åƒ" class="diary-upload-image"></p>
        {% endif %}

        <div class="partner-message-wrapper">
            {% if diary.user.profile_image %}
            <img src="{{  user.profile_image.url }}" alt="ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ç”»åƒ" class="partner-profile-image">
            {% endif %}
            <div class="partner-message">
                {% if diary.encouragement_message %}
                <p><strong>ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</strong><br>{{ diary.encouragement_message }}</p>
                {% else %}
                <p>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                {% endif %}
            </div>
        </div>

        <small>æŠ•ç¨¿æ—¥: {{ diary.date }}</small>
    </li>
    {% endfor %}
</ul>
{% else %}
<p>ã¾ã ã‚³ãƒ¡ãƒ³ãƒˆãŒæŠ•ç¨¿ã•ã‚Œã¦ã„ã¾ã›ã‚“ğŸ’­</p>
{% endif %}

<a href="{% url 'diary:diary_create' %}" class="btn-link" style="margin: 1em auto; display: block; max-width: 200px;">âœ
    æ–°ã—ãã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹</a>
{% endblock %}