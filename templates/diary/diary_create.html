{% extends 'diary/base.html' %}
{% load static %}

{% block title %}
ã‚³ãƒ¡ãƒ³ãƒˆä½œæˆ
{% endblock %}

{% block content %}

<!-- åˆå›ãƒ­ã‚°ã‚¤ãƒ³ç”¨ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
{% if not profile_image_url %}
{% if not user.personality %}
{% if not user.tone %}
<!-- ğŸ‘‡ã“ã“ã«ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãªã©å…¥ã‚Œã¦OK -->
<div id="firstLoginPopup" class="popup">
    <button id="closePopupBtn" class="popup-close-btn">Ã—</button>
    <div class="popup-content">
        <h2>DiaryAIã«ã‚ˆã†ã“ãï¼ğŸ‰</h2>
        <p>ã“ã“ã§ã¯æ¯æ—¥ã®æ—¥è¨˜ã«è‡ªåˆ†ã ã‘ã®ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼AIãŒè¿”ä¿¡ã‚’ãã‚Œã¾ã™ã€‚<br>
            ã¾ãšã¯<a href="{% url 'accounts:mypage'%}">ãƒã‚¤ãƒšãƒ¼ã‚¸</a>ã§ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼AIã®è¨­å®šã‚’ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼</p>
    </div>
</div>

<script>
    document.getElementById('closePopupBtn').addEventListener('click', function () {
        document.getElementById('firstLoginPopup').style.display = 'none';
    });
</script>
{% endif %}
{% endif %}
{% endif %}


<h1>âœ’ï¸ æ—¥è¨˜ä½œæˆ</h1>
<h3>ğŸŒ¤ï¸ ä»Šæ—¥ã¯ã©ã‚“ãªä¸€æ—¥ã ã£ãŸï¼Ÿ</h3>
<hr class="cp_hr02" />
<form method="POST" enctype="multipart/form-data">
    {% csrf_token %}

    <!-- ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div style="margin: 2.5em;">
        <div style="margin-bottom: 1.5em; ">
            {{ form.title }}
        </div>
        <div style="margin-bottom: 1.5em; ">
            {{ form.text }}
        </div>
    </div>

    <!-- æ„Ÿæƒ…é¸æŠãƒœã‚¿ãƒ³
        <div style="margin-bottom: 1.5em; text-align: center;">
            <button type="button" class="mood-btn happy">ğŸ˜Š æ¥½ã—ã„</button>
            <button type="button" class="mood-btn sad">ğŸ˜¢ æ‚²ã—ã„</button>
            <button type="button" class="mood-btn angry">ğŸ˜¡ æ€’ã£ã¦ã‚‹</button>
            <button type="button" class="mood-btn calm">ğŸ˜Œ ãŠã ã‚„ã‹</button>
            <button type="button" class="mood-btn anxious">ğŸ˜Ÿ ä¸å®‰</button>
            <button type="button" class="mood-btn exhausted">ğŸ˜© ç–²ã‚Œã¦ã‚‹</button>
        </div>
        -->

    <!-- æ„Ÿæƒ…é¸æŠãƒœã‚¿ãƒ³ -->
    <h3>ğŸ˜¶â€ğŸŒ«ï¸ ä»Šã®æ°—åˆ†ã¯ï¼Ÿ</h3>
    <hr class="cp_hr02" />
    <div class="mood-group">
        <label class="mood-btn happy">
            {{ form.mood_happy }}
            <span>ğŸ˜Š æ¥½ã—ã„</span>
        </label>
        <label class="mood-btn sad">
            {{ form.mood_sad }}
            <span>ğŸ˜¢ æ‚²ã—ã„</span>
        </label>
        <label class="mood-btn angry">
            {{ form.mood_angry }}
            <span>ğŸ˜¡ æ€’ã£ã¦ã‚‹</span>
        </label>
        <label class="mood-btn anxious">
            {{ form.mood_anxious }}
            <span>ğŸ˜Ÿ ä¸å®‰</span>
        </label>
        <label class="mood-btn calm">
            {{ form.mood_calm }}
            <span>ğŸ˜Œ ãŠã ã‚„ã‹</span>
        </label>
        <label class="mood-btn exhausted">
            {{ form.mood_exhausted }}
            <span>ğŸ¥± ç–²ã‚Œã¦ã‚‹</span>
        </label>
    </div>

    <!-- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¬„ -->
    <h3>ğŸ“¸ å†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã‚ˆã†ï¼</h3>
    <hr class="cp_hr02" />
    <input type="file" name="image" id="imageInput">
    <!-- ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
    <img id="imagePreview" src="#" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼" width="20%" height="20%"> <br>

    <!-- ã‚³ãƒ¡ãƒ³ãƒˆé€ä¿¡ãƒœã‚¿ãƒ³ -->
    <div style="text-align: center;">
        <input type="submit" value="ã‚³ãƒ¡ãƒ³ãƒˆé€ä¿¡" class="mood-btn"
            style="background-color: #007bff; color: white; border: none; padding: 0.7em 1.5em; border-radius: 4px; cursor: pointer;">
    </div>
</form>

<script>
    const imageInput = document.getElementById('imageInput');
    const imagePreview = document.getElementById('imagePreview');
    const noImageSrc = "./static/img/noimage.jpg";

    imageInput.addEventListener('change', function () {
        const file = this.files[0];
        console.log(file); // é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®æƒ…å ±ã‚’è¡¨ç¤º

        if (file) {
            const reader = new FileReader();

            reader.addEventListener('load', function () {
                console.log("ç”»åƒã®srcã«è¨­å®šã™ã‚‹ãƒ‡ãƒ¼ã‚¿:", reader.result); // è¨­å®šã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª
                imagePreview.src = reader.result;
                imagePreview.style.display = 'block';
            });

            reader.readAsDataURL(file);
        } else {
            // ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ãªã„å ´åˆã€noimage.png ã‚’è¡¨ç¤º
            imagePreview.src = noImageSrc;
        }
    });

    //imagePreview.style.display = 'block';


    console.log(imageInput);
    console.log(imagePreview);
</script>
{% endblock %}