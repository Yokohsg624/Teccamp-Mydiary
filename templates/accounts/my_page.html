{% extends 'diary/base.html' %}
{% load static %}


{% block content %}
<div class="mypage-container">
    <h2 class="mypage-title">ğŸ’– ãƒã‚¤ãƒšãƒ¼ã‚¸ ğŸ’–</h2>
    <hr class="pink-divider">

    <p><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼å:</strong> {{ user.username }}</p>
    <p><strong>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</strong> {{ user.email }}</p>
    <p><strong>æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³:</strong> {{ user.last_login }}</p>
    <p><strong>ã‚³ãƒ¡ãƒ³ãƒˆæ•°:</strong> {{ diary_count }}</p>

    {% if profile_image_url %}
    <h3 class="section-title">ğŸ“· ç¾åœ¨ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ</h3>
    <div class="image-wrapper">
        <img src="{{ profile_image_url }}" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ" class="profile-image">
    </div>
    {% else %}
    <p class="no-image-text">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã¯ã¾ã è¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
    {% endif %}

    <form method="POST" enctype="multipart/form-data" action="{% url 'accounts:mypage' %}" class="upload-form">
        {% csrf_token %}
        <h3 class="section-title">âœ¨ æ–°ã—ã„ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã‚’ã‚¢ãƒƒãƒ—ã—ã‚ˆã† âœ¨</h3>
        <input type="file" name="profile_image" id="imageInput" class="file-input">

        <div class="image-wrapper">
            <img id="imagePreview" src="#" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼" class="preview-image">
        </div>

        <div class="button-wrapper">
            <input type="submit" value="ä¿å­˜ã™ã‚‹ğŸ’¾" class="submit-btn">
        </div>
    </form>
</div>

<script>
    const imageInput = document.getElementById('imageInput');
    const imagePreview = document.getElementById('imagePreview');
    const noImageSrc = "{% static 'img/noimage.jpg' %}";

    imageInput.addEventListener('change', function () {
        const file = this.files[0];

        if (file) {
            const reader = new FileReader();
            reader.addEventListener('load', function () {
                imagePreview.src = reader.result;
                imagePreview.style.display = 'block';
            });
            reader.readAsDataURL(file);
        } else {
            imagePreview.src = noImageSrc;
            imagePreview.style.display = 'block';
        }
    });
</script>
{% endblock %}