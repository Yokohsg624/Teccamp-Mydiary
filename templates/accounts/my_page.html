{% extends 'diary/base.html' %}
{% load static %}


{% block content %}
<div class="mypage-container">
    <h2 class="mypage-title">âš™ï¸ ãƒã‚¤ãƒšãƒ¼ã‚¸ âš™ï¸</h2>

    <h3>ğŸ—£ï¸ ã‚ãªãŸã®æƒ…å ±</h3>
    <hr class="cp_hr02" />

    <p><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼å:</strong> {{ user.username }}</p>
    <p><strong>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</strong> {{ user.email }}</p>
    <p><strong>æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³:</strong> {{ user.last_login }}</p>
    <p><strong>ã‚³ãƒ¡ãƒ³ãƒˆæ•°:</strong> {{ diary_count }}</p>
    <br>

    <h3>ğŸ—£ï¸ ã‚ãªãŸã®ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼è¨­å®š</h3>
    <hr class="cp_hr02" />


    <!-- åˆå›ãƒ­ã‚°ã‚¤ãƒ³ç”¨ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    {% if not profile_image_url %}
    {% if not user.personality %}
    {% if not user.tone %}
    <!-- ğŸ‘‡ã“ã“ã«ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãªã©å…¥ã‚Œã¦OK -->
    <div id="firstLoginPopup" class="popup">
        <button id="closePopupBtn" class="popup-close-btn">Ã—</button>
        <div class="popup-content">
            <p>ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã®<strong>ã‚¢ã‚¤ã‚³ãƒ³ãƒ»æ€§æ ¼ãƒ»è©±ã—æ–¹</strong>ãŒæœªè¨­å®šã§ã™ã€‚<br>
                ã¾ãšã¯è‡ªåˆ†å¥½ã¿ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ã€ã‚ãªãŸã ã‘ã®ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚’ä½œã‚Šã¾ã—ã‚‡ã†ï¼</p>
        </div>
    </div>

    <script>
        document.getElementById('closePopupBtn').addEventListener('click', function () {
            document.getElementById('firstLoginPopup').style.display = 'none';
        });
    </script>
    {% endif %}
    {% endif %}
    {% endif %}


    {% if profile_image_url %}
    <p class="section-title">ğŸ“· ç¾åœ¨ã®ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ ğŸ“·</p>
    <div class="image-wrapper">
        <img src="{{ profile_image_url }}" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ" class="profile-image">
    </div>
    {% else %}
    <p class="no-image-text">ã‚¢ã‚¤ã‚³ãƒ³ãŒã¾ã è¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
    {% endif %}

    <form method="POST" enctype="multipart/form-data" action="{% url 'accounts:mypage' %}"
        class="upload-form personality-form">
        {% csrf_token %}
        <p class="section-title">âœ¨ æ–°ã—ã„ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ âœ¨</p>
        <input type="file" name="profile_image" id="imageInput" class="file-input">

        <div class="image-wrapper">
            <img id="imagePreview" src="#" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼" class="preview-image">
        </div>

        <div class="button-wrapper">
            <input type="submit" value="ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä¿å­˜ã™ã‚‹" class="submit-btn">
        </div>
    </form>
    <br>
    <!-- ğŸ‘‡ ã“ã“ã‹ã‚‰æ€§æ ¼ã¨å£èª¿ã®ãƒ•ã‚©ãƒ¼ãƒ è¿½åŠ  -->
    <form method="POST" action="{% url 'accounts:mypage' %}" class="personality-form">
        {% csrf_token %}
        <label for="personality">
            <p class="section-title">ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã®æ€§æ ¼:</p>
        </label>
        <textarea name="personality" id="personality" rows="2" class="text-input" 
        placeholder="ä¾‹: ã„ã¤ã‚‚ãƒ‘ãƒ¯ãƒ•ãƒ«ã§å‰å‘ããªæ€§æ ¼ã€é ­è„³æ˜æ™°ã€ç§ã¨äº¤éš›ã—ã¦ã„ã‚‹ã€ITä¼æ¥­ã«å‹¤ã‚ã¦ã„ã‚‹ etc...">{{ user.personality |default_if_none:''}}</textarea>

        <label for="tone">
            <p class="section-title">ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã®è©±ã—æ–¹ãƒ»å£èª¿:</p>
        </label>
        <textarea name="tone" id="tone" rows="2" class="text-input"
        placeholder="ä¾‹: æ•¬èªã€èªå°¾ã«â™ªãŒã¤ãã€çµµæ–‡å­—ã‚’ã‚ˆãä½¿ã†ã€ç§ã®ã“ã¨ã‚’ã€Œâ—‹â—‹ã•ã‚“ã€ã¨å‘¼ã¶ etc...">{{ user.tone |default_if_none:''}}</textarea>
        <br>
        <div class="button-wrapper padding-1em">
            <input type="submit" value="æ€§æ ¼ã¨å£èª¿ã‚’ä¿å­˜ã™ã‚‹" class="submit-btn">
        </div>
    </form>
    <!-- ğŸ‘† ã“ã“ã¾ã§è¿½åŠ  -->
</div>


<script>
    const imageInput = document.getElementById('imageInput');
    const imagePreview = document.getElementById('imagePreview');
    const noImageSrc = "{% static 'img/noimage.jpg' %}";

    imageInput.addEventListener('change', function () {
        const file = this.files[0];

        if (file) {
            const reader = new FileReader();
            reader.addEventListener('load', function () {
                imagePreview.src = reader.result;
                imagePreview.style.display = 'block';
            });
            reader.readAsDataURL(file);
        } else {
            imagePreview.src = noImageSrc;
            imagePreview.style.display = 'block';
        }
    });

</script>
{% endblock %}